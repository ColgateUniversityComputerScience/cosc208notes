# Multiprocessing: exec; non-preemptive scheduling
_COSC 208, Introduction to Computer Systems, 2022-11-11_

## Announcements
* DEI Assignment 3 due Tuesday
* Exam 3
    * Study guide posted on Moodle
    * Take-home portion: released Wed, Nov 16; due Fri, Nov 18
    * In-class portion: Fri, Nov 18 

## Outline
* Warm-up
* Running a different program
* Scheduling processes
* First In First Out (FIFO) scheduling
* Shortest Job First (SJF) scheduling

## Warm-up (Q5 from Wednesday)


## Running a different program
* `int exec(const char *path, const char *argv[])`
    * Used to switch which program is running in a process — replaces current code with code for a new program and starts executing that program from main
    * `path` == full path to program
    * `argv` == array of strings containing the full path to the program, any command line arguments, and `NULL`
* Example program
    ```C
    int main(int argc, char **argv) {
        printf("Begin\n");
        int pid = fork();
        if (pid == 0) {
            printf("Child\n");
            char *cmd[] = { "/usr/bin/date", NULL };
            execv(cmd[0], cmd);
        } else {
            printf("Parent\n");
        }
        printf("End\n");
        return 0;
    }
    ```
    ```
    Begin
    Parent
    End 
    Child
    Fri Nov 11 13:20:00 UTC 2022
    ```

* Q2: _What is the output produced by running `./progA`, assuming no errors occur?_
    **progA:**
    ```C
    int main() {
        pid_t a = fork();
        if (a == 0) {
            execv("./progB", NULL);
            printf("A 2nd gen\n");
            return 0;
        } else {
            wait(NULL);
            printf("A 1st gen\n");
            return 0;
        }
    }
    ```
    **progB:**
    ```C
    int main() {
        pid_t b = fork();
        if (b == 0) {
            printf("B 2nd gen\n");
            return 0;
        } else {
            wait(NULL);
            printf("B 1st gen\n");
            return 0;
        }
    }
    ```
    ```
    B 2nd gen
    B 1st gen
    A 1st gen
    ```

## Scheduling processes
* OS decides which process to run and for how long
* _What factors should the OS consider when making these decisions?_
    * Time for process to complete
    * Overhead of context switching
    * Fairness
    * User interaction
* For now, consider one of these metrics: turnaround time
    * T<sub>turnaround</sub> = T<sub>complete</sub> - T<sub>arrive</sub>
* For now, assume a process starts and runs to completion—i.e., no I/O and no preemption

## First In First Out (FIFO) scheduling

| Process | Arrival time | Duration | 
|---------|--------------|----------|
| A       | 0            | 15       |
| B       | 5            | 15       |
| C       | 10           | 15       |

* _What is the average turnaround time for the processes using FIFO?_
    ```
    ┌──────────────┬──────────────┬──────────────┐
    │ A            │ B            │ C            │
    └──────────────┴──────────────┴──────────────┘
    0              15             30             45
    ```
    * Average Turnaround = (15 + 25 + 35) / 3 = 25
* _What happens if A’s duration is 60?_
    ```
    ┌────────────────────────────────────────────────────────┬──────────────┬──────────────┐
    │ A                                                      │ B            │ C            │
    └────────────────────────────────────────────────────────┴──────────────┴──────────────┘
    0                                                        60             75             90
    ```
    * Average Turnaround = (60 + 70 + 80) / 3 = 70
* Q3: _Consider the following processes:_

    | Process | Arrival time | Duration | 
    |---------|--------------|----------|
    | A       | 0            | 15       |
    | B       | 5            | 15       |
    | C       | 10           | 60       |

    _Determine the schedule and compute the turnaround time for each process using First In First Out (FIFO) scheduling._
    ```
    ┌──────────────┬──────────────┬────────────────────────────────────────────────────────┐
    │ A            │ B            │ C                                                      │
    └──────────────┴──────────────┴────────────────────────────────────────────────────────┘
    0              15             30                                                       90
    ```
    Average Turnaround = (15 + 25 + 80) / 3 = 40
* _How can we change the schedule so the average turnaround time when A’s duration is 60 is more like the average turnaround time when C’s duration is 60?_

## Shortest Job First (SJF) scheduling

| Process | Arrival time | Duration | 
|---------|--------------|----------|
| A       | 0            | 60       |
| B       | 0            | 15       |
| C       | 0            | 15       |

* _What is the average turnaround time for the above processes using SJF?_
    ```
    ┌──────────────┬──────────────┬────────────────────────────────────────────────────────┐
    │ B            │ C            │ A                                                      │
    └──────────────┴──────────────┴────────────────────────────────────────────────────────┘
    0              15             30                                                       90
    ```
    * Average Turnaround = (15 + 30 + 90) / 3 = 45

| Process | Arrival time | Duration | 
|---------|--------------|----------|
| A       | 0            | 60       |
| B       | 5            | 15       |
| C       | 10            | 15       |

* _What is the average turnaround time for the above processes using SJF?_
    ```
    ┌────────────────────────────────────────────────────────┬──────────────┬──────────────┐
    │ A                                                      │ B            │ C            │
    └────────────────────────────────────────────────────────┴──────────────┴──────────────┘
    0                                                        60             75             90
    ```
    * Average Turnaround = (60 + 70 + 80) / 3 = 70
    * We're back to FIFO—_What happened!? How can we fix this?_
